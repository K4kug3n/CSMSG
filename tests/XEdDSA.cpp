#include <catch2/catch_test_macros.hpp>

#include <vector>
#include <array>

#include <XEdDSA.hpp>

TEST_CASE("XEdDSA Signature", "[XEdDSA]") {
	SECTION("Test Vector 1") {
		std::array<uint8_t, 32> priv = { 0, 142, 4, 173, 25, 26, 94, 45, 22, 142, 163, 230, 237, 29, 22, 200, 71, 53, 196, 75, 14, 213, 230, 178, 155, 129, 144, 109, 35, 49, 106, 108 };
		std::array<uint8_t, 32> pub = { 72, 125, 132, 142, 92, 50, 52, 54, 60, 116, 221, 32, 192, 255, 34, 2, 173, 136, 36, 91, 49, 34, 245, 122, 214, 239, 156, 144, 112, 53, 174, 54 };
		std::array<uint8_t, 64> nonce = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };
		std::vector<uint8_t> msg = { 0x72 };
		std::array<uint8_t, 64> signature = XEdDSA_sign(priv, msg, nonce);

		REQUIRE(signature == std::array<uint8_t, 64>{ 
			61, 226, 101, 17, 196, 6, 250, 49, 91, 237, 152, 27, 103, 223, 135, 227, 87, 35, 230, 235, 39, 54, 210, 158, 56, 137, 246, 75, 225, 42, 179, 222, 211, 0, 148, 235, 182, 107, 62, 56, 153, 237, 187, 151, 56, 228, 70, 69, 116, 190, 41, 236, 201, 109, 141, 244, 239, 54, 148, 84, 241, 26, 84, 136
		});

		REQUIRE(XEdDSA_verify(pub, msg, signature) == true);
	}

	SECTION("Test Vector 2") {
		std::array<uint8_t, 32> priv = { 72, 180, 155, 100, 83, 250, 173, 8, 80, 71, 160, 253, 217, 23, 167, 58, 20, 130, 252, 110, 133, 246, 42, 157, 190, 198, 233, 206, 170, 111, 195, 86 };
		std::array<uint8_t, 32> pub = { 232, 121, 1, 40, 71, 166, 82, 158, 57, 145, 40, 8, 153, 61, 163, 211, 218, 32, 248, 153, 35, 114, 144, 23, 102, 129, 176, 107, 221, 181, 64, 87 };
		std::array<uint8_t, 64> nonce = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };
		std::vector<uint8_t> msg = { 0x18, 0x84, 0xF3 };
		std::array<uint8_t, 64> signature = XEdDSA_sign(priv, msg, nonce);

		REQUIRE(signature == std::array<uint8_t, 64>{
			202, 29, 246, 94, 233, 99, 178, 72, 234, 27, 218, 52, 149, 179, 166, 211, 53, 168, 190, 92, 87, 84, 79, 157, 128, 200, 47, 241, 144, 213, 255, 26, 55, 153, 255, 196, 175, 196, 219, 72, 193, 119, 67, 56, 193, 99, 252, 108, 241, 73, 212, 228, 158, 141, 14, 172, 133, 72, 28, 127, 173, 18, 201, 131
		});

		REQUIRE(XEdDSA_verify(pub, msg, signature) == true);
	}

	SECTION("Test Vector 3") {
		std::array<uint8_t, 32> priv = { 128, 5, 154, 236, 126, 115, 194, 204, 111, 225, 254, 26, 131, 72, 106, 121, 52, 114, 204, 216, 27, 89, 122, 165, 167, 219, 153, 217, 222, 135, 234, 127 };
		std::array<uint8_t, 32> pub = { 140, 155, 228, 124, 129, 176, 248, 247, 200, 204, 138, 77, 129, 124, 60, 248, 246, 124, 45, 97, 24, 189, 202, 124, 204, 210, 153, 159, 207, 135, 195, 53 };
		std::array<uint8_t, 64> nonce = { 234, 173, 172, 230, 156, 214, 87, 208, 229, 82, 138, 67, 96, 132, 50, 213, 130, 124, 10, 134, 203, 167, 244, 70, 188, 26, 87, 204, 192, 165, 142, 186, 220, 79, 175, 213, 130, 4, 30, 107, 12, 7, 211, 92, 75, 159, 166, 8, 60, 152, 87, 134, 58, 109, 248, 167, 15, 207, 180, 13, 22, 16, 160, 95 };
		std::vector<uint8_t> msg = { 0x23, 0xA7, 0x49 };
		std::array<uint8_t, 64> signature = XEdDSA_sign(priv, msg, nonce);

		REQUIRE(signature == std::array<uint8_t, 64>{
			199, 22, 166, 119, 121, 133, 22, 241, 7, 133, 193, 2, 61, 23, 175, 24, 238, 245, 133, 181, 248, 77, 152, 110, 5, 86, 148, 90, 21, 74, 32, 105, 214, 207, 22, 51, 119, 72, 55, 126, 253, 143, 34, 179, 111, 163, 112, 104, 104, 82, 107, 100, 255, 28, 247, 141, 132, 77, 10, 132, 189, 13, 144, 7
		});

		REQUIRE(XEdDSA_verify(pub, msg, signature) == true);
	}
}

